<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proyecto Zen - Centro de Operaciones</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@800&family=Inter:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- BRANDING VARIABLES --- */
        :root {
            --accent-color: #22D3EE;
            --accent-color-hover: #06B6D4;
            --accent-text-color: #0F172A;
            --bg-color: #0F172A;
            --surface-color: rgba(30, 41, 59, 0.5); /* Slate-800 with transparency */
            --border-color: rgba(51, 65, 85, 0.6);
            --text-primary: #F1F5F9;
            --text-secondary: #94A3B8;
            --ai-glow-color: #a855f7; /* Purple 500 */
        }

        /* --- ESTILOS COMPARTIDOS Y NUEVO FONDO --- */
        @keyframes aurora-bg {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        body { 
            font-family: 'Inter', sans-serif; 
            background: var(--bg-color);
            background-image: radial-gradient(at 27% 37%, hsla(215, 98%, 61%, 0.1) 0px, transparent 50%), 
                              radial-gradient(at 97% 21%, hsla(190, 98%, 61%, 0.1) 0px, transparent 50%), 
                              radial-gradient(at 75% 88%, hsla(280, 96%, 63%, 0.1) 0px, transparent 50%);
            background-size: 200% 200%;
            animation: aurora-bg 20s ease infinite;
            color: var(--text-primary);
        }

        .accent-color { color: var(--accent-color); }
        .accent-bg { 
            background: linear-gradient(145deg, var(--accent-color), var(--accent-color-hover));
            color: var(--accent-text-color); 
            border: none;
            box-shadow: 0 4px 15px -5px var(--accent-color);
        }
        .accent-bg:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px -5px var(--accent-color);
        }
        
        /* --- NUEVO ESTILO GLASSMORPHISM PARA TARJETAS --- */
        .card-bg { 
            background-color: var(--surface-color);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
        }

        .item-disabled {
            opacity: 0.3; pointer-events: none; cursor: not-allowed;
            background-color: rgba(17, 24, 39, 0.7) !important; 
            border-color: #334155 !important;
        }
        
        /* --- UX EN TARJETAS MEJORADO --- */
        .item-card, .item-card label {
            -webkit-user-select: none; -ms-user-select: none; user-select: none;
        }
        
        .tooltip-container { position: relative; }
        .tooltip-content {
            visibility: hidden; opacity: 0; position: absolute; top: 100%; left: 50%;
            transform: translateX(-50%) translateY(8px); z-index: 100; width: max-content; 
            max-width: 380px; padding: 10px 14px; border-radius: 8px; 
            background-color: rgba(30, 41, 59, 0.9);
            backdrop-filter: blur(8px);
            border: 1px solid var(--accent-color); color: var(--text-primary); 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            font-size: 0.875rem; line-height: 1.5; transition: opacity 0.3s, transform 0.3s;
            pointer-events: none; text-align: left;
        }
        .item-card:hover .tooltip-content, .tooltip-container:hover .tooltip-content { visibility: visible; opacity: 1; transform: translateX(-50%) translateY(5px); }
        .tooltip-content::before {
            content: ''; position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%);
            border-width: 6px; border-style: solid; border-color: transparent transparent rgba(30, 41, 59, 0.9) transparent;
        }
        .custom-checkbox, .custom-radio {
            appearance: none; -webkit-appearance: none; width: 1.5rem; height: 1.5rem;
            border-radius: 0.375rem; border: 2px solid #64748B; cursor: pointer;
            transition: all 0.2s; position: relative; flex-shrink: 0;
            background-color: rgba(255,255,255,0.1);
        }
        .custom-checkbox:checked, .custom-radio:checked {
            background-color: var(--accent-color); border-color: var(--accent-color);
        }
        .custom-checkbox:checked::after {
            content: '✓'; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); color: var(--accent-text-color); 
            font-size: 0.9rem; font-weight: bold;
        }
        .custom-radio { border-radius: 50%; }
        .item-card { transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease; }
        .item-card:not(.item-disabled):hover {
            border-color: var(--accent-color);
            box-shadow: 0 0 15px -5px var(--accent-color);
            transform: translateY(-3px); z-index: 20;
        }
        
        /* ESTILO MEJORADO PARA INPUTS */
        .styled-input, .styled-textarea, .styled-select {
            padding: 0.75rem; background-color: rgba(31, 41, 55, 0.5); color: var(--text-secondary); 
            border: 1px solid var(--border-color); border-radius: 0.5rem; 
            transition: all 0.2s ease;
        }
        .styled-input:focus, .styled-textarea:focus, .styled-select:focus {
            outline: none; border-color: var(--accent-color); 
            box-shadow: 0 0 0 2px rgba(34, 211, 238, 0.3);
            background-color: rgba(31, 41, 55, 0.8);
        }
        .styled-textarea { min-height: 80px; }
        .action-button {
            padding: 0.5rem 0.75rem; font-size: 0.875rem;
            border-radius: 0.5rem; transition: background-color 0.2s;
        }

        /* --- ESTILOS SISTEMA DE PUNTOS --- */
        .points-display {
            background-color: rgba(15, 23, 42, 0.6); 
            border: 1px solid var(--accent-color);
            border-radius: 0.5rem; padding: 0.75rem 1rem; margin-bottom: 1rem;
            text-align: center; font-weight: bold; font-size: 1.1rem; color: #F8FAFC;
        }
        .points-display span { color: var(--accent-color); }

        /* --- ESTILOS CHAT IA REFINADOS --- */
        #ai-assistant-container {
            --chat-bg: rgba(30, 41, 59, 0.5);
            --chat-inner-bg: rgba(15, 23, 42, 0.6);
            --chat-border: rgba(51, 65, 85, 0.6);
            --chat-text: var(--text-primary);
            --chat-bubble-ai-bg: #334155;
            --chat-bubble-ai-text: #F8FAFC;
            --chat-bubble-user-bg: var(--accent-color);
            --chat-bubble-user-text: var(--accent-text-color);
            --chat-mode-btn-text: #94a3b8;
            --chat-input-bg: rgba(31, 41, 55, 0.5);
            --chat-input-border: var(--border-color);
            --chat-input-text: #94A3B8;
            --icon-color: #94A3B8;
            transition: background-color 0.3s, color 0.3s, box-shadow 0.3s;
            box-shadow: 0 0 25px -8px var(--ai-glow-color);
        }
        #ai-assistant-container.chat-light-mode {
            --chat-bg: rgba(241, 245, 249, 0.8);
            --chat-inner-bg: #FFFFFF;
            --chat-border: #CBD5E1;
            --chat-text: #1E293B;
            --chat-bubble-ai-bg: #E2E8F0;
            --chat-bubble-ai-text: #1E293B;
            --chat-bubble-user-bg: var(--accent-color);
            --chat-bubble-user-text: var(--accent-text-color);
            --chat-mode-btn-text: #475569;
            --chat-input-bg: rgba(248, 250, 252, 0.9);
            --chat-input-border: #E2E8F0;
            --chat-input-text: #1E293B;
            --icon-color: #475569;
            box-shadow: 0 0 25px -8px var(--accent-color);
        }
        #ai-assistant-container { 
            background-color: var(--chat-bg); color: var(--chat-text); border-color: var(--chat-border);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
        }
        #ai-assistant-container h2 { color: var(--ai-glow-color); }
        #ai-assistant-container.chat-light-mode h2 { color: #9333ea; }
        #chat-messages { background-color: var(--chat-inner-bg); border-color: var(--chat-border); }
        .chat-bubble.chat-bubble-ai { background-color: var(--chat-bubble-ai-bg); color: var(--chat-bubble-ai-text); }
        .chat-bubble.chat-bubble-user { background: linear-gradient(145deg, var(--accent-color), var(--accent-color-hover)); color: var(--chat-bubble-user-text); }
        #chat-mode-selector { border-bottom-color: var(--chat-border); }
        .chat-mode-btn { padding: 8px 16px; border: none; background: transparent; color: var(--chat-mode-btn-text); font-weight: 600; cursor: pointer; transition: all 0.3s; border-bottom: 3px solid transparent; }
        .chat-mode-btn.active { color: var(--accent-color); border-bottom-color: var(--accent-color); }
        #ai-assistant-container #chat-input { background-color: var(--chat-input-bg); border-color: var(--chat-input-border); color: var(--chat-input-text); }
        
        .theme-switch-wrapper { display: flex; align-items: center; gap: 8px; }
        .theme-switch { position: relative; display: inline-block; width: 40px; height: 20px; }
        .theme-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #475569; transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent-color); }
        input:checked + .slider:before { transform: translateX(20px); }
        .theme-switch-wrapper .icon { width: 16px; height: 16px; color: var(--icon-color); transition: color 0.3s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }
        .animate-bounce { animation: bounce 1.4s infinite ease-in-out both; }
        
        /* --- HIERARCHY & INTERACTION FIX --- */
        #splash-screen { z-index: 100000; }
        #tour-tooltip { z-index: 99999; }
        .tour-highlight-active { z-index: 99998; }
        #tour-overlay { z-index: 99997; }
        .modal-overlay { z-index: 90000; }
        #ai-chat-focus-container { z-index: 80000; }
        
        /* --- ESTILOS TOUR GUIADO PROFESIONAL --- */
        #tour-tooltip {
            font-size: 1rem; line-height: 1.6;
            transition: top 0.3s ease-in-out, left 0.3s ease-in-out;
        }
        .tour-highlight-active {
            position: relative; border-radius: 8px;
            box-shadow: 0 0 0 4px var(--accent-color);
            transition: box-shadow 0.3s ease-in-out;
        }

        /* Spinner */
        .spinner { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* --- SPLASH SCREEN STYLES --- */
        #splash-screen {
            position: fixed; inset: 0;
            display: flex; align-items: center; justify-content: center;
            background: #0F172A;
            transition: opacity 0.5s ease-out;
        }
        .splash-container { text-align: center; }
        .lotus-icon {
            width: 100px; height: 100px; margin: 0 auto 1.5rem;
            stroke: #22D3EE; stroke-width: 2; fill: transparent;
        }
        .splash-title {
            font-family: 'Orbitron', sans-serif; font-size: clamp(2.8rem, 6vw, 4rem);
            line-height: 1.1; text-transform: uppercase; letter-spacing: 4px;
            text-shadow: 0 0 15px rgba(34, 211, 238, 0.6);
        }
        .splash-byline {
            font-size: clamp(0.9rem, 2vw, 1.0rem); color: #94A3B8;
            letter-spacing: 2px; margin-top: 0.5rem;
        }
        .splash-byline a { text-decoration: none; color: inherit; }
        .splash-action-button {
            display: inline-block;
            background: #22D3EE; color: #0F172A; font-weight: bold;
            padding: 0.75rem 1.5rem; border-radius: 0.5rem;
            margin-top: 2rem; text-decoration: none;
            transition: all 0.3s ease;
        }
        .splash-action-button:hover { background: #06B6D4; transform: translateY(-2px); }
        .splash-secondary-button {
            background: transparent; border: 1px solid #334155;
            color: #94A3B8; margin-left: 1rem;
        }
        .splash-secondary-button:hover { background: #1E293B; border-color: #64748B; }
        .details-section {
            max-height: 0; overflow-y: hidden; overflow-x: auto;
            transition: max-height 0.7s ease-in-out; text-align: left;
            max-width: 1000px; margin: 2rem auto 0; color: #CBD5E1;
        }
        .details-section.open { max-height: 1200px; }
        .tts-highlight {
            background-color: rgba(34, 211, 238, 0.15);
            border-left: 3px solid var(--accent-color);
            padding-left: 8px; transition: all 0.2s ease-in-out;
        }

        /* --- OPTIMIZACIONES DE FLUIDEZ --- */
        .modal-overlay {
            background-color: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(8px);
            transition: opacity 0.3s ease-in-out;
        }
        .modal-overlay > div {
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }
        .modal-overlay.opacity-0 { opacity: 0; }
        .modal-overlay.opacity-0 > div { transform: scale(0.95); opacity: 0; }
        #tasksDashboard { transition: opacity 0.3s ease-in-out; }
        
        .btn-press-feedback { transition: transform 0.1s ease-out; }
        .btn-press-feedback:active:not(:disabled) { transform: scale(0.97); }
        
        /* --- ESTILOS ESTUDIO DE CONTENIDO --- */
        .studio-tab { border-bottom: 3px solid transparent; transition: all 0.2s; }
        .studio-tab.active { color: var(--accent-color); border-bottom-color: var(--accent-color); }
        .studio-tab-content { display: none; }
        .studio-tab-content.active { display: block; }

        /* --- MODO ENFOQUE CHAT --- */
        #ai-assistant-container.is-focused { height: 100% !important; }

        /* --- ESTILOS ADICIONALES PARA MEJORAR JERARQUÍA --- */
        h1, h2, h3 { letter-spacing: -0.02em; }
        h1#main-title { letter-spacing: 0.05em; text-shadow: 0 0 8px rgba(34, 211, 238, 0.4); }
        .card-bg h2 {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.75rem;
            margin-bottom: 1.25rem !important;
        }

    </style>
</head>
<body class="text-slate-50 min-h-screen">

    <!-- SPLASH SCREEN -->
    <div id="splash-screen">
        <div class="splash-container p-4">
            <svg class="lotus-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <path d="M50 5 C40 35 40 65 50 95 M50 5 C60 35 60 65 50 95 M50 80 C30 60 30 40 38 15 M50 80 C70 60 70 40 62 15 M50 95 C20 80 15 50 28 40 M50 95 C80 80 85 50 72 40 M28 40 C40 60 45 75 50 80 M72 40 C60 60 55 75 50 80" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <h1 class="splash-title">Proyecto Zen</h1>
            <p class="splash-byline">by <a href="https://websoin.netlify.app/" target="_blank" rel="noopener noreferrer" class="hover:text-white transition">SO->IN</a></p>

            <div>
                <button id="start-app-btn" class="splash-action-button">Comenzar</button>
                <button id="toggle-details-btn" class="splash-action-button splash-secondary-button">Saber más</button>
            </div>

            <div id="detailsSection" class="details-section">
                <div class="p-4 border border-slate-700 rounded-lg bg-slate-800/50 space-y-4" style="min-width: 700px;">
                    <div class="text-center">
                        <button id="read-aloud-btn" class="bg-slate-700 hover:bg-slate-600 text-slate-200 font-semibold py-2 px-6 rounded-lg transition shadow-md btn-press-feedback">
                            Leer en voz alta
                        </button>
                    </div>
                    <div>
                        <h3 class="font-bold text-lg text-cyan-400 mb-2">Tus 3 Ventajas Competitivas</h3>
                        <p class="mb-2 text-sm" data-tts-content="Pilar 1: Tu Arsenal de Ventas IA. Esto no es solo una herramienta, es tu ventaja competitiva. Un experto en ventas IA que entiende las necesidades de tu cliente y construye propuestas ganadoras usando tu propio catálogo de servicios. Está diseñado para hacerte lucir como un estratega y cerrar tratos más rápido.">
                            <b>1. Tu Arsenal de Ventas IA:</b> Esto no es solo una herramienta, es tu ventaja competitiva. Un experto en ventas IA que entiende las necesidades de tu cliente y construye propuestas ganadoras usando <em>tu propio</em> catálogo de servicios. Está diseñado para hacerte lucir como un estratega y cerrar tratos más rápido.
                        </p>
                        <p class="mb-2 text-sm" data-tts-content="Pilar 2: Proyecta Profesionalismo Instantáneo. Te damos una plataforma que automatiza las partes tediosas para que te concentres en la relación con el cliente. Genera propuestas 'marca blanca' con tu logo, briefs técnicos para tu equipo y gestiona todo tu pipeline de ventas visualmente. Tú vendes, la plataforma organiza.">
                            <b>2. Proyecta Profesionalismo Instantáneo:</b> Te damos una plataforma que automatiza las partes tediosas para que te concentres en la relación con el cliente. Genera propuestas 'marca blanca' con <em>tu logo</em>, briefs técnicos para tu equipo y gestiona todo tu pipeline de ventas visualmente. Tú vendes, la plataforma organiza.
                        </p>
                        <p class="mb-4 text-sm" data-tts-content="Pilar 3: Rentabilidad y Control Total. Esta plataforma es tu centro de comando financiero. La calculadora te permite definir tu margen de ganancia en cada proyecto, mostrándote al instante el precio final para el cliente y tus ganancias. Sin hojas de cálculo, sin adivinanzas. Visibilidad total, control total.">
                            <b>3. Rentabilidad y Control Total:</b> Esta plataforma es tu centro de comando financiero. La calculadora te permite definir tu margen de ganancia en cada proyecto, mostrándote al instante el precio final para el cliente y tus ganancias. Sin hojas de cálculo, sin adivinanzas. Visibilidad total, control total.
                        </p>
                    </div>
                    
                    <div class="border-t border-slate-700 pt-4">
                        <h3 class="font-bold text-lg text-cyan-400 mb-2">Tu Flujo de Venta en 5 Pasos</h3>
                         <ol class="list-decimal list-inside space-y-2 text-sm">
                            <li data-tts-content="Paso 1, Descubre la Necesidad Real: Usa el modo 'Analizar Conversación'. Pega el email o chat de un cliente. La IA actúa como tu analista, dándote una lista clara de sus puntos de dolor. Empezarás cada llamada de ventas con información precisa.">
                                <b>Descubre la Necesidad Real:</b> Usa el modo 'Analizar Conversación'. Pega el email o chat de un cliente. La IA actúa como tu analista, dándote una lista clara de sus puntos de dolor. Empezarás cada llamada de ventas con información precisa.
                            </li>
                            <li data-tts-content="Paso 2, Construye la Oferta Perfecta: Cambia al modo 'Constructor'. Describe el objetivo del cliente. La IA crea una propuesta estratégica desde tu catálogo, sugiriendo inteligentemente servicios de mayor valor (upsells) para maximizar el proyecto y tu ganancia.">
                                <b>Construye la Oferta Perfecta:</b> Cambia al modo 'Constructor'. Describe el objetivo del cliente. La IA crea una propuesta estratégica desde tu catálogo, sugiriendo inteligentemente servicios de mayor valor (upsells) para maximizar el proyecto y tu ganancia.
                            </li>
                            <li data-tts-content="Paso 3, Domina tu Rentabilidad: Ve a la calculadora. Define tu margen de ganancia deseado. El precio para el cliente se actualiza al instante. Aquí es donde tomas decisiones de negocio, no solo técnicas.">
                                <b>Domina tu Rentabilidad:</b> Ve a la calculadora. Define tu margen de ganancia deseado. El precio para el cliente se actualiza al instante. Aquí es donde tomas decisiones de negocio, no solo técnicas.
                            </li>
                            <li data-tts-content="Paso 4, Gestiona tu Pipeline como un Pro: Guarda la propuesta. Aparece en tu dashboard, tu centro de comando para todas las oportunidades. Marca tratos como 'urgentes', edita sobre la marcha y visualiza tus ganancias potenciales de un vistazo.">
                                <b>Gestiona tu Pipeline como un Pro:</b> Guarda la propuesta. Aparece en tu dashboard, tu centro de comando para todas las oportunidades. Marca tratos como 'urgentes', edita sobre la marcha y visualiza tus ganancias potenciales de un vistazo.
                            </li>
                            <li data-tts-content="Paso 5, Cierra el Trato con Documentos Impecables: Con un clic, genera dos documentos críticos: una propuesta profesional 'marca blanca' con tu marca para el cliente, y un brief técnico detallado para tu equipo interno o desarrolladores. Ahorras horas y proyectas una imagen excepcional.">
                                <b>Cierra el Trato con Documentos Impecables:</b> Con un clic, genera dos documentos críticos: una propuesta profesional 'marca blanca' con <em>tu marca</em> para el cliente, y un brief técnico detallado para tu equipo interno o desarrolladores. Ahorras horas y proyectas una imagen excepcional.
                            </li>
                         </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- MAIN APP CONTAINER (Initially Hidden) -->
    <div id="main-app" class="hidden p-4 sm:p-6 md:p-10">
        <!-- TÍTULO PRINCIPAL Y CONTROLES -->
        <div class="max-w-7xl mx-auto">
            <header class="text-center mb-8">
                <div class="flex justify-center items-center gap-4 min-h-[48px]">
                    <img id="brand-logo-display" src="" alt="Logo" class="hidden h-12"/>
                    <h1 id="main-title" class="text-3xl sm:text-4xl font-extrabold accent-color tracking-wider">
                        Centro de Operaciones
                    </h1>
                </div>
                <p class="text-slate-400 mt-2">Crea, gestiona y exporta propuestas de alto impacto.</p>
                 <div class="mt-4 flex flex-wrap justify-center gap-3">
                    <button id="show-branding-modal-btn" class="text-sm bg-slate-700 hover:bg-slate-600 text-slate-200 font-semibold py-2 px-4 rounded-lg transition shadow-md btn-press-feedback">
                        ⚙️ Configuración de Marca
                    </button>
                    <button id="change-api-key-btn" class="text-sm bg-slate-700 hover:bg-slate-600 text-slate-200 font-semibold py-2 px-4 rounded-lg transition shadow-md btn-press-feedback">
                        🔑 Cambiar API Key
                    </button>
                    <button id="restart-tour-btn" class="text-sm bg-slate-700 hover:bg-slate-600 text-slate-200 font-semibold py-2 px-4 rounded-lg transition shadow-md btn-press-feedback">
                        🔄 Reiniciar Tour
                    </button>
                    <button id="show-content-studio-btn" class="text-sm bg-fuchsia-600 hover:bg-fuchsia-500 text-white font-semibold py-2 px-4 rounded-lg transition shadow-md btn-press-feedback">
                        ✨ Estudio de Contenido
                    </button>
                    <button id="tieredBuilderBtn" class="text-sm bg-indigo-600 hover:bg-indigo-500 text-white font-semibold py-2 px-4 rounded-lg transition shadow-md btn-press-feedback">
                        📊 Propuesta por Niveles
                    </button>
                    <div class="flex items-center gap-2">
                        <button id="currency-toggle-btn" disabled class="text-sm bg-slate-700 hover:bg-slate-600 text-slate-200 font-semibold py-2 px-4 rounded-lg transition shadow-md disabled:opacity-50 disabled:cursor-not-allowed btn-press-feedback"></button>
                        <button id="configure-rate-btn" class="h-8 w-8 flex items-center justify-center rounded-full bg-slate-700 text-slate-300 hover:bg-slate-600 transition btn-press-feedback" aria-label="Configurar tipo de cambio manual">
                           <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                              <path d="M10 3.75a2 2 0 100 4 2 2 0 000-4zM4.375 3.75a2 2 0 100 4 2 2 0 000-4zM15.625 3.75a2 2 0 100 4 2 2 0 000-4zM10 12.25a2 2 0 100 4 2 2 0 000-4zM4.375 12.25a2 2 0 100 4 2 2 0 000-4zM15.625 12.25a2 2 0 100 4 2 2 0 000-4z" />
                           </svg>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Contenedor Principal -->
            <div id="appContainer" class="flex flex-col lg:grid lg:grid-cols-3 xl:grid-cols-4 gap-8">
                <!-- COLUMNA 1 & 2: Formulario -->
                <div class="lg:col-span-2 xl:col-span-3 space-y-6">
                    <div id="proposal-details-container" class="card-bg p-5 rounded-xl shadow-lg">
                        <h2 class="text-2xl font-semibold accent-color">1. Iniciar Nueva Propuesta</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <input type="text" id="clientName" placeholder="Nombre del Cliente" class="styled-input">
                            <input type="text" id="webName" placeholder="Nombre del Proyecto" class="styled-input">
                            <select id="serviceType" class="styled-input styled-select accent-color">
                                <option value="puntual">Proyecto de Pago Único</option>
                                <option value="mensual">Servicio Mensual (Retainer)</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- CONTENEDOR DEL CHAT IA -->
                    <div id="ai-assistant-container" class="card-bg p-5 rounded-xl shadow-lg flex flex-col h-[70vh] lg:h-[500px] relative">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center">
                                <h2 class="text-2xl font-semibold text-purple-400">Asistente IA de Ventas</h2>
                                <span id="ai-status-indicator" class="ml-3 h-3 w-3 bg-red-500 rounded-full"></span>
                            </div>
                            <div class="flex items-center gap-3">
                                <button id="toggle-chat-focus-btn" class="text-slate-400 hover:text-white transition hidden lg:flex items-center justify-center h-8 w-8 rounded-full hover:bg-slate-700" aria-label="Modo Enfoque" title="Activar Modo Enfoque">
                                    <svg id="focus-icon-expand" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 0h-4m4 0l-5-5" />
                                    </svg>
                                    <svg id="focus-icon-collapse" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                                <button id="clear-chat-history-btn" class="text-slate-400 hover:text-white transition" aria-label="Limpiar historial del chat" title="Limpiar historial del chat actual">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg>
                                </button>
                                <div class="theme-switch-wrapper">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="icon"><path d="M10 2a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0110 2zM10 15a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0110 15zM10 7a3 3 0 100 6 3 3 0 000-6zM15.657 5.404a.75.75 0 10-1.06-1.06l-1.061 1.06a.75.75 0 001.06 1.06l1.06-1.06zM6.464 14.596a.75.75 0 10-1.06-1.06l-1.06 1.06a.75.75 0 001.06 1.06l1.06-1.06zM18 10a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0118 10zM5 10a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 015 10zM14.596 15.657a.75.75 0 001.06-1.06l-1.06-1.061a.75.75 0 10-1.06 1.06l1.06 1.06zM5.404 6.464a.75.75 0 001.06-1.06l-1.06-1.06a.75.75 0 10-1.06 1.06l1.06 1.06z"/></svg>
                                    <label class="theme-switch" for="chat-theme-toggle">
                                        <input type="checkbox" id="chat-theme-toggle">
                                        <span class="slider"></span>
                                    </label>
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="icon"><path fill-rule="evenodd" d="M7.455 2.164A.75.75 0 018 2.5v1.25a.75.75 0 01-1.5 0V3.065a8.5 8.5 0 00-5.438 6.942 9.009 9.009 0 003.354 7.512.75.75 0 01-1.026 1.09 10.509 10.509 0 01-3.88-8.602A10.001 10.001 0 018.75 2.055a.75.75 0 01-.545-.644.75.75 0 01.25-.748zM12.23 18.63a.75.75 0 01.748-.25.75.75 0 01.644.545 10.001 10.001 0 01-10.748 3.55 1.5 1.5 0 01-.32-2.924 10.05 10.05 0 015.613-5.562.75.75 0 01.966 1.139 8.548 8.548 0 00-4.63 4.725 8.5 8.5 0 007.477-2.168z" clip-rule="evenodd"/></svg>
                                </div>
                            </div>
                        </div>

                        <div id="chat-mode-selector" class="flex justify-start mb-2 border-b border-slate-700 -mx-5 px-5">
                            <button data-mode="builder" class="chat-mode-btn active">Constructor</button>
                            <button data-mode="objection" class="chat-mode-btn">Objeciones</button>
                            <button data-mode="analyze" class="chat-mode-btn">Analizar Conversación</button>
                        </div>
                        
                        <!-- NUEVO: API KEY OVERLAY -->
                        <div id="api-key-overlay" class="absolute inset-0 bg-slate-800/80 backdrop-blur-sm z-10 flex flex-col items-center justify-center p-4 rounded-xl hidden">
                            <div class="text-center max-w-sm">
                                <h3 class="text-lg font-semibold text-white">Configuración del Asistente IA</h3>
                                <p class="text-sm text-slate-300 mt-2 mb-4">
                                    Para activar el Asistente, por favor introduce tu propia API Key de Google AI.
                                </p>
                                <div class="flex gap-2">
                                    <input type="password" id="inlineApiKeyInput" class="styled-input w-full" placeholder="Pega tu clave aquí">
                                    <button id="save-inline-api-key-btn" class="accent-bg font-medium py-2 px-4 rounded-lg transition btn-press-feedback">Guardar</button>
                                </div>
                                <p class="text-xs text-slate-400 mt-2">
                                    ¿No tienes una clave? 
                                    <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer" class="accent-color hover:underline font-semibold">
                                        Obtén una API Key en Google AI Studio &rarr;
                                    </a>
                                </p>
                            </div>
                        </div>
                        
                        <div id="chat-messages" class="flex-grow space-y-4 overflow-y-auto p-2 bg-slate-900/50 rounded-lg border border-slate-700">
                            <!-- Los mensajes del chat aparecerán aquí dinámicamente -->
                        </div>

                        <div class="flex items-center gap-2 pt-4 border-t border-slate-700">
                            <input type="text" id="chat-input" class="w-full styled-input" placeholder="Ej: 'Necesito una web para un fotógrafo...' ">
                            <button id="chat-send-btn" class="accent-bg font-bold p-3 rounded-lg shadow-md transition duration-300 btn-press-feedback">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                    <path d="M3.105 2.289a.75.75 0 00-.826.95l1.414 4.949a.75.75 0 00.95.546l4.209-1.202a.75.75 0 01.531 1.343l-4.21 1.202a.75.75 0 00-.95.546l-1.414 4.95a.75.75 0 00.826.95L19 10.354a.75.75 0 000-1.418L3.105 2.289z" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div id="solution-config-container" class="card-bg p-5 rounded-xl shadow-lg">
                        <h2 class="text-2xl font-semibold accent-color">2. Configurar la Solución</h2>
                        <p class="text-sm text-slate-400 mb-4">Elige una solución integral (Paquete/Plan) o selecciona ítems específicos.</p>
                        
                        <div id="modeIndicator" class="mb-4 p-3 rounded-lg border border-yellow-500 bg-yellow-900/20 text-yellow-300 font-bold text-center">
                            Modo Activo: Selección Personalizada
                        </div>
                        
                        <div class="flex flex-col sm:flex-row gap-4 mb-4">
                            <button id="clearSelectionsBtn" class="hidden flex-grow bg-red-600 text-white font-bold py-2 rounded-lg hover:bg-red-700 transition shadow-lg btn-press-feedback">
                                Limpiar Selección y Activar Modo Personalizado
                            </button>
                            <button id="add-custom-service-modal-btn" class="flex-grow bg-purple-600 text-white font-bold py-2 rounded-lg hover:bg-purple-700 transition shadow-lg btn-press-feedback">
                                + Añadir Ítem Personalizado
                            </button>
                        </div>

                        <div id="monthlyPlansContainer" class="hidden space-y-6"></div>

                        <!-- ESTRUCTURA PARA SERVICIOS MENSUALES (SISTEMA DE PUNTOS) -->
                        <div id="monthlyServicesContainer" class="hidden space-y-6">
                            <div id="pointsDisplay" class="points-display flex justify-between items-center">
                                <div>Puntos de Desarrollo: <span id="planPointsCounter">0 / 0</span></div>
                                <button id="buyExtraPointsBtn" class="hidden text-sm bg-yellow-600 text-slate-900 font-bold py-1 px-3 rounded-lg hover:bg-yellow-500 transition shadow-md btn-press-feedback">+ Comprar Puntos</button>
                            </div>
                            <div id="servicesTabs" class="space-y-4">
                                <!-- Categorías se insertarán dinámicamente aquí -->
                            </div>
                        </div>

                        <div id="servicesSelection" class="space-y-6"></div>
                    </div>
                </div>

                <!-- COLUMNA 3 & 4: Resumen y Dashboard -->
                <div class="lg:col-span-1 xl:col-span-1 space-y-6">
                    
                    <div id="summaryCard" class="card-bg p-5 rounded-xl shadow-lg top-4">
                        <h2 class="text-2xl font-semibold accent-color">3. Calcular Rentabilidad</h2>
                        <div class="mb-4">
                            <label for="marginPercentage" class="block text-sm font-medium text-slate-300 mb-2">Tu Margen de Ganancia (%)</label>
                            <input type="number" id="marginPercentage" value="60" min="0" class="w-full styled-input accent-color">
                            <p id="marginFeedback" class="text-xs mt-1 text-slate-400"></p>
                        </div>
                        <div class="text-lg font-bold space-y-2 pt-4 border-t border-slate-700">
                            <p>Costo Producción: <span id="totalDeveloperPrice">$0.00 USD</span></p>
                            <p class="accent-color">Precio a Cliente: <span id="totalClientPrice">$0.00 USD</span></p>
                        </div>
                        <div class="mt-4">
                            <label for="isUrgentCheckbox" class="flex items-center gap-2 cursor-pointer p-2 rounded-md hover:bg-slate-700 transition">
                                <input type="checkbox" id="isUrgentCheckbox" class="custom-checkbox">
                                <span class="text-sm font-medium text-slate-200">Marcar como Propuesta Urgente</span>
                            </label>
                        </div>
                        <button id="addTask" class="w-full accent-bg font-bold py-3 mt-2 rounded-lg transition shadow-xl btn-press-feedback">Guardar Propuesta</button>
                        <h3 class="text-md font-semibold mt-6 mb-2 text-slate-300 border-t border-slate-700 pt-4">Resumen de la Solución:</h3>
                        <div id="selectedItems" class="text-sm space-y-2 p-3 bg-slate-900 rounded-lg h-40 overflow-y-auto border border-slate-700">
                            <p class="text-slate-400">Los servicios seleccionados aparecerán aquí.</p>
                        </div>
                    </div>

                    <div id="saved-proposals-container" class="card-bg p-5 rounded-xl shadow-lg">
                        <h2 class="text-2xl font-semibold text-pink-400">4. Propuestas Guardadas</h2>
                        <div id="tasksDashboard" class="space-y-4"><p class="text-slate-400">Aún no hay propuestas guardadas.</p></div>
                        <div class="text-lg font-bold space-y-2 pt-4 mt-4 border-t border-slate-700">
                            <p>COSTO TOTAL (Prod): <span id="grandTotalDeveloperPrice">$0.00 USD</span></p>
                            <p class="text-green-400">VENTA TOTAL: <span id="grandTotalClientPrice">$0.00 USD</span></p>
                            <p class="text-yellow-400">GANANCIA TOTAL: <span id="totalProfit">$0.00 USD</span></p>
                        </div>
                        <div class="mt-4 flex gap-2">
                            <button id="exportPdfBtn" class="flex-grow bg-slate-600 text-white font-bold py-2 rounded-lg hover:bg-slate-500 transition shadow-lg action-button btn-press-feedback">Generar Documentos</button>
                            <button id="clearAllTasksBtn" class="flex-grow bg-red-800 text-white font-bold py-2 rounded-lg hover:bg-red-700 transition shadow-lg action-button btn-press-feedback">Limpiar Todo</button>
                        </div>
                        <div class="mt-4 text-sm text-slate-500 text-center border-t border-slate-700 pt-4">
                            <a href="pricing.html" class="accent-color hover:underline">Gestionar Catálogo de Servicios</a>
                        </div>
                    </div>
                    <div id="messageContainer" class="mt-4"></div>
                </div>
            </div>
            
            <!-- FOOTER -->
            <footer class="text-center py-6 mt-10 border-t border-slate-700">
                <p class="text-sm text-slate-400">Desarrollado con ❤️ por <a href="https://websoin.netlify.app/" target="_blank" rel="noopener noreferrer" class="font-semibold accent-color hover:underline">SO-&gt;IN Soluciones Informáticas</a></p>
            </footer>
        </div>
    </div>
    
    <!-- MODO ENFOQUE CHAT -->
    <div id="ai-chat-focus-container" class="hidden fixed inset-0 z-[80000] p-4 sm:p-8 md:p-16 lg:p-24 bg-slate-900/50 backdrop-blur-sm opacity-0 transition-opacity duration-300">
        <!-- El contenedor del chat se moverá aquí -->
    </div>

    <!-- MODALES -->
    <div id="notificationModal" class="hidden fixed inset-0 flex items-center justify-center modal-overlay opacity-0">
        <div class="card-bg w-full max-w-sm rounded-xl shadow-2xl overflow-hidden transform scale-95" role="dialog" aria-modal="true">
            <div class="modal-header p-4 rounded-t-xl text-white font-bold flex justify-between items-center">
                <h3 id="notificationTitle" class="text-lg"></h3>
                <button id="close-notification-modal-btn-x" class="text-2xl font-bold hover:text-slate-200">&times;</button>
            </div>
            <div class="p-5">
                <p id="notificationMessage" class="text-sm text-slate-300"></p>
                <div class="mt-4 text-right">
                    <button id="close-notification-modal-btn-accept" class="bg-slate-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-slate-500 transition duration-300">Aceptar</button>
                </div>
            </div>
        </div>
    </div>
    <div id="customServiceModal" class="hidden fixed inset-0 flex items-center justify-center modal-overlay opacity-0">
        <div class="card-bg w-full max-w-md rounded-xl shadow-2xl overflow-hidden transform scale-95" role="dialog" aria-modal="true">
            <div class="modal-header p-4 rounded-t-xl text-white font-bold bg-purple-600 flex justify-between items-center">
                <h3 class="text-lg">Añadir Ítem Personalizado</h3>
                <button id="close-custom-service-modal-btn" class="text-2xl font-bold hover:text-slate-200">&times;</button>
            </div>
            <div class="p-5 space-y-4">
                <div>
                    <label for="customServiceName" class="block text-sm font-medium text-slate-300 mb-1">Nombre del Servicio:</label>
                    <input type="text" id="customServiceName" class="w-full styled-input" placeholder="Ej: Integración con API de terceros">
                </div>
                <div>
                    <label for="customServicePrice" class="block text-sm font-medium text-slate-300 mb-1">Costo de Producción (USD):</label>
                    <input type="number" id="customServicePrice" class="w-full styled-input" placeholder="0.00" min="0">
                </div>
                <div class="text-right pt-2">
                    <button id="add-custom-service-btn" class="bg-purple-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-purple-700 transition">Añadir Ítem</button>
                </div>
            </div>
        </div>
    </div>
     <div id="extraPointsModal" class="hidden fixed inset-0 flex items-center justify-center modal-overlay opacity-0">
        <div class="card-bg w-full max-w-md rounded-xl shadow-2xl overflow-hidden transform scale-95" role="dialog" aria-modal="true">
            <div class="modal-header p-4 rounded-t-xl text-white font-bold bg-yellow-600 flex justify-between items-center">
                <h3 class="text-lg text-slate-900">Comprar Puntos Extra</h3>
                <button id="close-extra-points-modal-btn" class="text-2xl font-bold hover:text-slate-200">&times;</button>
            </div>
            <div class="p-5 space-y-4">
                <p class="text-sm text-slate-300">Añade puntos de desarrollo adicionales a tu plan mensual para incluir más servicios.</p>
                <div>
                    <label for="extraPointsAmount" class="block text-sm font-medium text-slate-300 mb-1">Cantidad de Puntos a Comprar:</label>
                    <input type="number" id="extraPointsAmount" class="w-full styled-input" placeholder="0" min="1">
                </div>
                <p id="extraPointsCostFeedback" class="text-sm text-center font-bold text-yellow-300 h-5"></p>
                <div class="text-right pt-2">
                    <button id="add-extra-points-btn" class="bg-yellow-600 text-slate-900 font-bold py-2 px-4 rounded-lg hover:bg-yellow-500 transition">Añadir Puntos</button>
                </div>
            </div>
        </div>
    </div>
    <div id="pdfOptionsModal" class="hidden fixed inset-0 flex items-center justify-center modal-overlay opacity-0">
        <div class="card-bg w-full max-w-lg rounded-xl shadow-2xl overflow-hidden transform scale-95" role="dialog" aria-modal="true">
            <div class="modal-header p-4 rounded-t-xl text-white font-bold bg-blue-600 flex justify-between items-center">
                <h3 class="text-lg">Generar Documentos de Propuesta</h3>
                <button id="close-pdf-options-modal-btn" class="text-2xl font-bold hover:text-slate-200">&times;</button>
            </div>
            <div class="p-5 space-y-4 max-h-[80vh] overflow-y-auto">
                <div>
                    <label for="pdfLogoInput" class="block text-sm font-medium text-slate-300 mb-1">Tu Logo (Marca Blanca):</label>
                    <input type="file" id="pdfLogoInput" accept="image/*" class="w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-900 file:text-blue-300 hover:file:bg-blue-800">
                </div>
                <div>
                    <label for="pdfResellerInfo" class="block text-sm font-medium text-slate-300 mb-1">Tus Datos de Contacto:</label>
                    <textarea id="pdfResellerInfo" class="w-full styled-textarea" rows="3" placeholder="Tu Nombre / Nombre de tu Agencia&#10;tupaginaweb.com&#10;tu@email.com"></textarea>
                </div>
                <div>
                    <label for="pdfClientInfo" class="block text-sm font-medium text-slate-300 mb-1">Datos del Cliente Final:</label>
                    <textarea id="pdfClientInfo" class="w-full styled-textarea" rows="3" placeholder="Nombre del Contacto del Cliente&#10;Nombre de la Empresa Cliente&#10;email@cliente.com"></textarea>
                </div>
                <div>
                    <label for="pdfTerms" class="block text-sm font-medium text-slate-300 mb-1">Tus Términos y Condiciones:</label>
                    <textarea id="pdfTerms" class="w-full styled-textarea" rows="4" placeholder="Ej: Validez de la propuesta: 15 días. Condiciones de pago: 50% por adelantado para iniciar, 50% a la entrega final."></textarea>
                </div>
                <div class="pt-2 space-y-3">
                    <button id="generate-client-pdf-btn" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition flex justify-center items-center gap-2 btn-press-feedback" disabled>
                        <svg class="spinner h-5 w-5 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span class="btn-text">Generar Propuesta para Cliente</span>
                    </button>
                    <button id="generate-internal-pdf-btn" class="w-full bg-slate-600 text-white font-bold py-2 rounded-lg hover:bg-slate-500 transition flex justify-center items-center gap-2 btn-press-feedback" disabled>
                        <svg class="spinner h-5 w-5 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                             <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span class="btn-text">Generar Reporte Interno</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div id="brandingModal" class="hidden fixed inset-0 flex items-center justify-center modal-overlay opacity-0">
        <div class="card-bg w-full max-w-md rounded-xl shadow-2xl overflow-hidden transform scale-95" role="dialog" aria-modal="true">
            <div class="modal-header p-4 rounded-t-xl text-white font-bold bg-teal-600 flex justify-between items-center">
                <h3 class="text-lg">Configuración de Marca</h3>
                <button id="close-branding-modal-btn" class="text-2xl font-bold hover:text-slate-200">&times;</button>
            </div>
            <div class="p-5 space-y-4">
                <div>
                    <label for="brandLogoInput" class="block text-sm font-medium text-slate-300 mb-2">Tu Logo (para UI y PDFs):</label>
                    <input type="file" id="brandLogoInput" accept="image/*" class="w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-teal-900 file:text-teal-300 hover:file:bg-teal-800">
                    <button id="removeBrandLogo" class="text-xs text-red-400 hover:underline mt-1">Quitar logo</button>
                </div>
                <div>
                    <label for="brandColorInput" class="block text-sm font-medium text-slate-300 mb-2">Color de Acento:</label>
                    <input type="color" id="brandColorInput" class="w-full h-10 p-1 bg-slate-700 border border-slate-600 rounded-lg cursor-pointer">
                </div>
                <div class="text-right pt-2">
                    <button id="save-branding-btn" class="bg-teal-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-teal-700 transition">Guardar Cambios</button>
                </div>
            </div>
        </div>
    </div>
    <div id="tieredBuilderModal" class="hidden fixed inset-0 flex items-center justify-center modal-overlay opacity-0">
        <div class="card-bg w-full max-w-6xl rounded-xl shadow-2xl transform scale-95 max-h-[90vh] flex flex-col" role="dialog" aria-modal="true">
            <div class="modal-header p-4 rounded-t-xl text-white font-bold bg-indigo-600 flex justify-between items-center flex-shrink-0">
                <div class="flex items-center gap-3">
                    <h3 class="text-lg">Constructor de Propuesta por Niveles</h3>
                    <button id="show-tiered-builder-help-btn-modal" class="h-6 w-6 flex items-center justify-center rounded-full bg-indigo-700 text-indigo-200 hover:bg-indigo-500 transition btn-press-feedback" aria-label="Ayuda sobre Propuesta por Niveles">
                        ?
                    </button>
                </div>
                <button id="close-tiered-builder-modal-btn" class="text-2xl font-bold hover:text-slate-200">&times;</button>
            </div>
            <div class="p-5 flex-grow overflow-y-auto">
                <p class="text-sm text-slate-400 mb-4 italic">Usa el nivel Básico para lo esencial, el Recomendado para la solución ideal, y el Completo para añadir todos los extras de alto valor.</p>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-4" id="tiered-builder-columns">
                    <!-- Columnas se generarán aquí -->
                </div>
            </div>
            <div class="p-4 bg-slate-900/50 rounded-b-xl flex-shrink-0 flex justify-end items-center gap-4">
                 <button id="cancel-tiered-builder-btn" class="bg-slate-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-slate-500 transition">Cancelar</button>
                <button id="add-tiered-proposal-btn" class="bg-indigo-600 text-white font-bold py-2 px-5 rounded-lg hover:bg-indigo-700 transition">Guardar Propuesta por Niveles</button>
            </div>
        </div>
    </div>
    
    <!-- ESTUDIO DE CONTENIDO MODAL -->
    <div id="contentStudioModal" class="hidden fixed inset-0 flex items-center justify-center modal-overlay opacity-0">
        <div class="card-bg w-full max-w-4xl rounded-xl shadow-2xl transform scale-95 max-h-[90vh] flex flex-col" role="dialog" aria-modal="true">
            <div class="modal-header p-4 rounded-t-xl text-white font-bold bg-fuchsia-600 flex justify-between items-center flex-shrink-0">
                <h3 class="text-lg">✨ Estudio de Contenido para Redes</h3>
                <button id="close-content-studio-modal-btn" class="text-2xl font-bold hover:text-slate-200">&times;</button>
            </div>
            <div class="p-5 flex-grow overflow-y-auto">
                <div class="flex border-b border-slate-700 mb-4">
                    <button data-tab="text-generator" class="studio-tab py-2 px-4 font-semibold active">Generador de Textos</button>
                    <button data-tab="image-generator" class="studio-tab py-2 px-4 font-semibold">Generador de Imágenes</button>
                </div>
                <!-- Pestaña Generador de Textos -->
                <div id="text-generator-content" class="studio-tab-content active">
                    <p class="text-sm text-slate-400 mb-4">Crea textos persuasivos para tus redes sociales en segundos. Elige tus opciones y deja que la IA haga la magia.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="text-service-to-promote" class="block text-sm font-medium text-slate-300 mb-1">Servicio a Promocionar:</label>
                            <select id="text-service-to-promote" class="styled-input styled-select w-full"></select>
                        </div>
                        <div>
                            <label for="text-cta" class="block text-sm font-medium text-slate-300 mb-1">Llamada a la Acción (Opcional):</label>
                            <input type="text" id="text-cta" class="styled-input w-full" placeholder="Ej: ¡Contáctame para una auditoría!">
                        </div>
                        <div>
                            <label for="text-platform" class="block text-sm font-medium text-slate-300 mb-1">Plataforma:</label>
                            <select id="text-platform" class="styled-input styled-select w-full">
                                <option value="instagram">Instagram</option>
                                <option value="linkedin">LinkedIn</option>
                                <option value="facebook">Facebook</option>
                            </select>
                        </div>
                        <div>
                            <label for="text-tone" class="block text-sm font-medium text-slate-300 mb-1">Tono:</label>
                            <select id="text-tone" class="styled-input styled-select w-full">
                                <option value="profesional">Profesional</option>
                                <option value="urgente">Urgente y Directo</option>
                                <option value="inspirador">Inspirador</option>
                                <option value="cercano">Cercano y Amigable</option>
                            </select>
                        </div>
                    </div>
                    <button id="generate-text-btn" class="w-full accent-bg font-bold py-3 rounded-lg transition shadow-xl btn-press-feedback">Generar Texto</button>
                    <div id="text-result-container" class="mt-4 p-4 bg-slate-900 rounded-lg border border-slate-700 min-h-[150px] relative hidden">
                         <div id="text-spinner" class="absolute inset-0 flex items-center justify-center bg-slate-900/80 rounded-lg hidden">
                            <svg class="spinner h-8 w-8 text-cyan-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                        </div>
                        <p id="generated-text" class="text-slate-200 whitespace-pre-wrap"></p>
                        <button id="copy-generated-text-btn" class="absolute top-2 right-2 text-xs bg-slate-800 text-cyan-300 font-bold py-1 px-2 rounded hover:bg-cyan-800 transition hidden">Copiar</button>
                    </div>
                </div>
                <!-- Pestaña Generador de Imágenes -->
                <div id="image-generator-content" class="studio-tab-content">
                     <p class="text-sm text-slate-400 mb-4">Crea imágenes publicitarias únicas y profesionales. La IA está entrenada para generar contenido relevante para servicios de desarrollo web.</p>
                     <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label for="image-service-to-promote" class="block text-sm font-medium text-slate-300 mb-1">Concepto (Basado en Servicio):</label>
                            <select id="image-service-to-promote" class="styled-input styled-select w-full"></select>
                        </div>
                        <div>
                            <label for="image-style" class="block text-sm font-medium text-slate-300 mb-1">Estilo Visual:</label>
                            <select id="image-style" class="styled-input styled-select w-full">
                                <option value="minimalista">Estilo Minimalista</option>
                                <option value="futurista">Estilo Futurista y Neón</option>
                                <option value="fotorealista">Estilo Fotorealista</option>
                                <option value="abstracto">Estilo Abstracto y Corporativo</option>
                            </select>
                        </div>
                        <div>
                             <label for="image-colors" class="block text-sm font-medium text-slate-300 mb-1">Paleta de Colores:</label>
                            <select id="image-colors" class="styled-input styled-select w-full">
                                <option value="tonos_azules">Tonos Azules y Blancos</option>
                                <option value="blanco_negro">Blanco y Negro</option>
                                <option value="colores_vibrantes">Colores Vibrantes</option>
                                <option value="tonos_calidos">Tonos Cálidos (Naranja/Dorado)</option>
                            </select>
                        </div>
                    </div>
                    <button id="generate-image-btn" class="w-full accent-bg font-bold py-3 rounded-lg transition shadow-xl btn-press-feedback">Generar Imagen</button>
                     <div id="image-result-container" class="mt-4 p-4 bg-slate-900 rounded-lg border border-slate-700 min-h-[300px] flex items-center justify-center relative hidden">
                        <div id="image-spinner" class="absolute inset-0 flex flex-col items-center justify-center bg-slate-900/80 rounded-lg hidden">
                            <svg class="spinner h-8 w-8 text-cyan-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                            <p class="text-cyan-300 mt-2 font-semibold">Generando imagen... (Esto puede tardar un minuto)</p>
                        </div>
                        <img id="generated-image" src="" alt="Imagen generada por IA" class="max-w-full max-h-[400px] rounded-md hidden">
                        <a id="download-image-btn" href="#" download="proyecto-zen-imagen.png" class="absolute bottom-4 right-4 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-md hidden">Descargar</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tour GUIADO PROFESIONAL -->
    <div id="tour-overlay" class="hidden fixed inset-0 bg-black/70 transition-opacity duration-300"></div>
    <div id="tour-tooltip" class="hidden absolute bg-slate-800 border-2 border-cyan-400 p-4 rounded-lg shadow-2xl max-w-sm">
        <p id="tour-text" class="text-slate-200"></p>
        <div class="flex justify-between items-center mt-4">
            <span id="tour-step-counter" class="text-xs text-slate-400"></span>
            <div class="space-x-2">
                <button id="tour-end" class="text-sm py-1 px-3 rounded bg-red-800 hover:bg-red-700 transition">Finalizar</button>
                <button id="tour-prev" class="text-sm py-1 px-3 rounded bg-slate-600 hover:bg-slate-500 transition">Anterior</button>
                <button id="tour-next" class="text-sm py-1 px-3 rounded accent-bg">Siguiente</button>
            </div>
        </div>
    </div>

    <!-- MODAL TIPO DE CAMBIO MANUAL -->
    <div id="exchangeRateModal" class="hidden fixed inset-0 flex items-center justify-center modal-overlay opacity-0">
        <div class="card-bg w-full max-w-md rounded-xl shadow-2xl overflow-hidden transform scale-95" role="dialog" aria-modal="true">
            <div class="modal-header p-4 rounded-t-xl text-white font-bold bg-green-600 flex justify-between items-center">
                <h3 class="text-lg">Configurar Tipo de Cambio Manual</h3>
                <button id="close-exchange-rate-modal-btn" class="text-2xl font-bold hover:text-slate-200">&times;</button>
            </div>
            <div class="p-5 space-y-4">
                <p class="text-sm text-slate-300">
                    Introduce el valor de 1 USD en ARS que deseas utilizar para todos los cálculos. Este valor se guardará en tu navegador.
                </p>
                <div>
                    <label for="exchangeRateInput" class="block text-sm font-medium text-slate-300 mb-1">1 USD = ARS:</label>
                    <input type="number" id="exchangeRateInput" class="w-full styled-input" placeholder="Ej: 1150.50" min="0">
                </div>
                <div class="text-right pt-2">
                    <button id="save-exchange-rate-btn" class="bg-green-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-green-700 transition">
                        Guardar Cotización
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- BOTÓN FLOTANTE DE WHATSAPP -->
    <a href="https://api.whatsapp.com/send?phone=5492617145654" target="_blank" rel="noopener noreferrer" class="fixed bottom-6 right-6 bg-green-500 hover:bg-green-600 text-white rounded-full p-3 shadow-lg z-50 transition transform hover:scale-110">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 24 24" fill="currentColor">
            <path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.487 5.235 3.487 8.413 0 6.557-5.338 11.892-11.894 11.892-1.99 0-3.903-.52-5.687-1.475L.057 24zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.447-4.435-9.884-9.888-9.884-5.448 0-9.886 4.434-9.889 9.884-.001 2.225.651 4.315 1.731 6.086l-.516 1.866 1.88-.515z"/>
        </svg>
    </a>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script type="module" src="js/main.js"></script>

</body>
</html>