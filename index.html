<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proyecto Zen - Centro de Operaciones</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@800&family=Inter:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- BRANDING VARIABLES --- */
        :root {
            --accent-color: #22D3EE;
            --accent-color-hover: #06B6D4;
            --accent-text-color: #0F172A;
        }

        /* --- ESTILOS COMPARTIDOS --- */
        body { 
            font-family: 'Inter', sans-serif; 
            background: #0F172A; /* Slate-900: Azul marino oscuro */
            color: #E2E8F0;
        }
        .accent-color { 
            color: var(--accent-color); 
        }
        .accent-bg { 
            background-color: var(--accent-color); 
            color: var(--accent-text-color); 
        }
        .accent-bg:hover:not(:disabled) {
            background-color: var(--accent-color-hover);
        }
        .card-bg { 
            background-color: #1E293B; /* Slate-800: Fondo de tarjeta */
        }
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: 50000;
        }
        .item-disabled {
            opacity: 0.3; 
            pointer-events: none;
            cursor: not-allowed;
            background-color: #111827 !important; 
            border-color: #334155 !important;
        }
        
        /* --- UX EN TARJETAS --- */
        .item-card, .item-card label {
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        .tooltip-container { position: relative; }
        .tooltip-content {
            visibility: hidden; opacity: 0; position: absolute; top: 100%; left: 50%;
            transform: translateX(-50%) translateY(5px); z-index: 100; width: max-content; 
            max-width: 380px; padding: 10px 14px; border-radius: 8px; background-color: #1E293B;
            border: 1px solid var(--accent-color); color: #F8FAFC; box-shadow: 0 4px 12px rgba(0, 0, 0, 1);
            font-size: 0.875rem; line-height: 1.5; transition: opacity 0.3s, transform 0.3s;
            pointer-events: none; text-align: left;
        }
        .item-card:hover .tooltip-content { visibility: visible; opacity: 1; }
        .tooltip-content::before {
            content: ''; position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%);
            border-width: 6px; border-style: solid; border-color: transparent transparent #1E293B transparent;
        }
        .custom-checkbox, .custom-radio {
            appearance: none; -webkit-appearance: none; width: 1.5rem; height: 1.5rem;
            border-radius: 0.375rem; border: 2px solid #64748B; cursor: pointer;
            transition: all 0.2s; position: relative; flex-shrink: 0;
        }
        .custom-checkbox:checked, .custom-radio:checked {
            background-color: var(--accent-color); border-color: var(--accent-color);
        }
        .custom-checkbox:checked::after {
            content: '✓'; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); color: var(--accent-text-color); 
            font-size: 0.9rem; font-weight: bold;
        }
        .custom-radio { border-radius: 50%; }
        .item-card:not(.item-disabled):hover {
            background-color: #334155; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            transform: translateY(-2px); z-index: 20;
        }
        .styled-input, .styled-textarea, .styled-select {
            padding: 0.75rem; background-color: #1F2937; color: #94A3B8; 
            border: 1px solid #374151; border-radius: 0.5rem; transition: all 0.2s;
        }
        .styled-input:focus, .styled-textarea:focus, .styled-select:focus {
            outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 1px var(--accent-color);
        }
        .styled-textarea { min-height: 80px; }
        .action-button {
            padding: 0.5rem 0.75rem; font-size: 0.875rem;
            border-radius: 0.5rem; transition: background-color 0.2s;
        }

        /* --- ESTILOS SISTEMA DE PUNTOS --- */
        .points-display {
            background-color: #0F172A; border: 1px solid var(--accent-color);
            border-radius: 0.5rem; padding: 0.75rem 1rem; margin-bottom: 1rem;
            text-align: center; font-weight: bold; font-size: 1.1rem; color: #F8FAFC;
        }
        .points-display span { color: var(--accent-color); }

        /* --- ESTILOS CHAT IA --- */
        #ai-assistant-container {
            --chat-bg: #1E293B; /* Slate-800 */
            --chat-inner-bg: #0F172A; /* Slate-900 */
            --chat-border: #334155; /* Slate-700 */
            --chat-text: #E2E8F0; /* Slate-200 */
            --chat-bubble-ai-bg: #334155; /* Slate-700 */
            --chat-bubble-ai-text: #F8FAFC; /* Slate-50 */
            --chat-bubble-user-bg: var(--accent-color);
            --chat-bubble-user-text: var(--accent-text-color);
            --chat-mode-btn-text: #94a3b8;
            --chat-input-bg: #1F2937;
            --chat-input-border: #374151;
            --chat-input-text: #94A3B8;
            --icon-color: #94A3B8;
            transition: background-color 0.3s, color 0.3s;
        }
        #ai-assistant-container.chat-light-mode {
            --chat-bg: #F1F5F9; /* Slate-100 */
            --chat-inner-bg: #FFFFFF;
            --chat-border: #CBD5E1; /* Slate-300 */
            --chat-text: #1E293B; /* Slate-800 */
            --chat-bubble-ai-bg: #E2E8F0; /* Slate-200 */
            --chat-bubble-ai-text: #1E293B;
            --chat-bubble-user-bg: var(--accent-color);
            --chat-bubble-user-text: var(--accent-text-color);
            --chat-mode-btn-text: #475569; /* Slate-600 */
            --chat-input-bg: #F8FAFC; /* Slate-50 */
            --chat-input-border: #E2E8F0; /* Slate-200 */
            --chat-input-text: #1E293B;
            --icon-color: #475569;
        }
        #ai-assistant-container { 
            background-color: var(--chat-bg); 
            color: var(--chat-text); 
            border-color: var(--chat-border);
        }
        #ai-assistant-container h2 { color: #c084fc; } /* text-purple-400 */
        #ai-assistant-container.chat-light-mode h2 { color: #9333ea; } /* purple-600 for light mode */
        #chat-messages { background-color: var(--chat-inner-bg); border-color: var(--chat-border); }
        .chat-bubble.chat-bubble-ai { background-color: var(--chat-bubble-ai-bg); color: var(--chat-bubble-ai-text); }
        .chat-bubble.chat-bubble-user { background-color: var(--chat-bubble-user-bg); color: var(--chat-bubble-user-text); }
        #chat-mode-selector { border-bottom-color: var(--chat-border); }
        .chat-mode-btn { padding: 8px 16px; border: none; background: transparent; color: var(--chat-mode-btn-text); font-weight: 600; cursor: pointer; transition: all 0.3s; border-bottom: 3px solid transparent; }
        .chat-mode-btn.active { color: var(--accent-color); border-bottom-color: var(--accent-color); }
        #ai-assistant-container #chat-input { background-color: var(--chat-input-bg); border-color: var(--chat-input-border); color: var(--chat-input-text); }
        .theme-switch-wrapper { display: flex; align-items: center; gap: 8px; }
        .theme-switch { position: relative; display: inline-block; width: 40px; height: 20px; }
        .theme-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #475569; transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent-color); }
        input:checked + .slider:before { transform: translateX(20px); }
        .theme-switch-wrapper .icon { width: 16px; height: 16px; color: var(--icon-color); transition: color 0.3s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }
        .animate-bounce { animation: bounce 1.4s infinite ease-in-out both; }
        
        /* --- ESTILOS TOUR GUIADO --- */
        #tour-tooltip #tour-text { /* Mejora de legibilidad */
            font-size: 1rem;
            line-height: 1.6;
        }
        .tour-highlight {
            box-shadow: 0 0 0 9999px rgba(0,0,0,0.7), 0 0 0 4px var(--accent-color);
            border-radius: 8px;
            position: relative;
            z-index: 10001;
            transition: box-shadow 0.3s ease-in-out;
        }
        /* Spinner */
        .spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* --- SPLASH SCREEN STYLES --- */
        #splash-screen {
            position: fixed; inset: 0; z-index: 10000;
            display: flex; align-items: center; justify-content: center;
            background: #0F172A;
            transition: opacity 0.5s ease-out;
        }
        .splash-container { text-align: center; }
        .lotus-icon {
            width: 100px; height: 100px; margin: 0 auto 1.5rem;
            stroke: #22D3EE; stroke-width: 2; fill: transparent;
        }
        .splash-title {
            font-family: 'Orbitron', sans-serif; font-size: clamp(2.8rem, 6vw, 4rem);
            line-height: 1.1; text-transform: uppercase; letter-spacing: 4px;
            text-shadow: 0 0 15px rgba(34, 211, 238, 0.6);
        }
        .splash-byline {
            font-size: clamp(0.9rem, 2vw, 1.0rem); color: #94A3B8;
            letter-spacing: 2px; margin-top: 0.5rem;
        }
        .splash-action-button {
            display: inline-block;
            background: #22D3EE; color: #0F172A; font-weight: bold;
            padding: 0.75rem 1.5rem; border-radius: 0.5rem;
            margin-top: 2rem; text-decoration: none;
            transition: all 0.3s ease;
        }
        .splash-action-button:hover { background: #06B6D4; transform: translateY(-2px); }
        .splash-secondary-button {
            background: transparent; border: 1px solid #334155;
            color: #94A3B8; margin-left: 1rem;
        }
        .splash-secondary-button:hover { background: #1E293B; border-color: #64748B; }

        .details-section {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.7s ease-in-out;
            text-align: left;
            max-width: 600px;
            margin: 2rem auto 0;
            color: #CBD5E1;
        }
         .details-section.open {
            max-height: 1000px; /* Adjust as needed */
        }
        .tts-btn {
            background: #1E293B; border: 1px solid #334155; color: #94A3B8;
            padding: 2px 6px; font-size: 0.7rem; border-radius: 4px;
            cursor: pointer; margin-left: 8px;
        }
    </style>
</head>
<body class="text-slate-50 min-h-screen">

    <!-- SPLASH SCREEN -->
    <div id="splash-screen">
        <div class="splash-container p-4">
            <svg class="lotus-icon" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M50 90C50 90 50 80 60 75C70 70 75 75 75 75M50 90C50 90 50 80 40 75C30 70 25 75 25 75M50 90C50 90 55 80 65 85C75 90 70 95 70 95M50 90C50 90 45 80 35 85C25 90 30 95 30 95M50 90V10M50 10C50 10 60 20 60 30C60 40 50 50 50 50M50 10C50 10 40 20 40 30C40 40 50 50 50 50M50 10C50 10 65 15 75 30C85 45 70 55 70 55M50 10C50 10 35 15 25 30C15 45 30 55 30 55" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <h1 class="splash-title">Proyecto Zen</h1>
            <p class="splash-byline">by SO->IN</p>

            <div>
                <button id="start-app-btn" class="splash-action-button">Comenzar</button>
                <button id="toggle-details-btn" class="splash-action-button splash-secondary-button">Saber más</button>
            </div>

            <div id="detailsSection" class="details-section">
                <div class="p-4 border border-slate-700 rounded-lg bg-slate-800/50">
                    <h3 class="font-bold text-lg text-cyan-400 mb-2">3 Pilares Fundamentales</h3>
                    <p class="mb-2 text-sm"><b>1. Co-Piloto IA Estratégico:</b>
                        <button class="tts-btn" data-text="Co-Piloto IA Estratégico: Más que un asistente, es un estratega que analiza, recomienda y busca oportunidades de venta, entendiendo el contexto de tu trabajo.">▶️</button>
                        Más que un asistente, es un estratega que analiza, recomienda y busca oportunidades de venta.
                    </p>
                    <p class="mb-2 text-sm"><b>2. Privacidad y Control Total:</b>
                         <button class="tts-btn" data-text="Privacidad y Control Total: Tu negocio, tus datos. La plataforma opera 100% en tu navegador, sin nubes ni suscripciones. Total autonomía.">▶️</button>
                        Tu negocio, tus datos. La plataforma opera 100% en tu navegador, sin nubes ni suscripciones.
                    </p>
                    <p class="mb-4 text-sm"><b>3. Flujo de Trabajo Eficiente:</b>
                         <button class="tts-btn" data-text="Flujo de Trabajo Eficiente: Desde el análisis del cliente hasta el PDF final, cada paso está diseñado para ahorrarte tiempo y maximizar tu rentabilidad.">▶️</button>
                        Desde el análisis hasta el PDF final, cada paso está diseñado para ahorrarte tiempo.
                    </p>
                    
                    <h3 class="font-bold text-lg text-cyan-400 mb-2 mt-4 border-t border-slate-700 pt-4">5 Pasos hacia la Propuesta Perfecta</h3>
                     <p class="text-sm mb-1"><b>1. Análisis:</b> <button class="tts-btn" data-text="Análisis: La IA extrae los requisitos clave de las conversaciones con tus clientes.">▶️</button> La IA extrae requisitos de las conversaciones.</p>
                     <p class="text-sm mb-1"><b>2. Construcción:</b> <button class="tts-btn" data-text="Construcción: La IA sugiere una solución estratégica y busca oportunidades de venta.">▶️</button> La IA sugiere una solución y busca oportunidades.</p>
                     <p class="text-sm mb-1"><b>3. Rentabilidad:</b> <button class="tts-btn" data-text="Rentabilidad: Ajustas tu margen de ganancia en tiempo real.">▶️</button> Ajustas tu margen de ganancia en tiempo real.</p>
                     <p class="text-sm mb-1"><b>4. Gestión:</b> <button class="tts-btn" data-text="Gestión: Guardas y gestionas todas tus propuestas en un dashboard centralizado.">▶️</button> Guardas y gestionas todo en un dashboard.</p>
                     <p class="text-sm"><b>5. Documentación:</b> <button class="tts-btn" data-text="Documentación: Generas PDFs profesionales para tu cliente y tu equipo de desarrollo con un solo clic.">▶️</button> Generas PDFs profesionales con un solo clic.</p>
                </div>
            </div>
        </div>
    </div>


    <!-- MAIN APP CONTAINER (Initially Hidden) -->
    <div id="main-app" class="hidden p-4 sm:p-6 md:p-10">
        <!-- MODALES -->
        <div id="notificationModal" class="hidden fixed inset-0 flex items-center justify-center modal-overlay transition-opacity duration-300">
            <div class="card-bg w-full max-w-sm rounded-xl shadow-2xl overflow-hidden transform transition-all" role="dialog" aria-modal="true">
                <div class="modal-header p-4 rounded-t-xl text-white font-bold flex justify-between items-center">
                    <h3 id="notificationTitle" class="text-lg"></h3>
                    <button onclick="closeNotificationModal()" class="text-2xl font-bold hover:text-slate-200">&times;</button>
                </div>
                <div class="p-5">
                    <p id="notificationMessage" class="text-sm text-slate-300"></p>
                    <div class="mt-4 text-right">
                        <button onclick="closeNotificationModal()" class="bg-slate-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-slate-500 transition duration-300">Aceptar</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="customServiceModal" class="hidden fixed inset-0 flex items-center justify-center modal-overlay transition-opacity duration-300">
            <div class="card-bg w-full max-w-md rounded-xl shadow-2xl overflow-hidden transform transition-all" role="dialog" aria-modal="true">
                <div class="modal-header p-4 rounded-t-xl text-white font-bold bg-purple-600 flex justify-between items-center">
                    <h3 class="text-lg">Añadir Ítem Personalizado</h3>
                    <button onclick="closeCustomServiceModal()" class="text-2xl font-bold hover:text-slate-200">&times;</button>
                </div>
                <div class="p-5 space-y-4">
                    <div>
                        <label for="customServiceName" class="block text-sm font-medium text-slate-300 mb-1">Nombre del Servicio:</label>
                        <input type="text" id="customServiceName" class="w-full styled-input" placeholder="Ej: Integración con API de terceros">
                    </div>
                    <div>
                        <label for="customServicePrice" class="block text-sm font-medium text-slate-300 mb-1">Costo de Producción (USD):</label>
                        <input type="number" id="customServicePrice" class="w-full styled-input" placeholder="0.00" min="0">
                    </div>
                    <div class="text-right pt-2">
                        <button onclick="addCustomServiceToSelection()" class="bg-purple-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-purple-700 transition">Añadir Ítem</button>
                    </div>
                </div>
            </div>
        </div>
         <div id="extraPointsModal" class="hidden fixed inset-0 flex items-center justify-center modal-overlay transition-opacity duration-300">
            <div class="card-bg w-full max-w-md rounded-xl shadow-2xl overflow-hidden transform transition-all" role="dialog" aria-modal="true">
                <div class="modal-header p-4 rounded-t-xl text-white font-bold bg-yellow-600 flex justify-between items-center">
                    <h3 class="text-lg text-slate-900">Comprar Puntos Extra</h3>
                    <button onclick="closeExtraPointsModal()" class="text-2xl font-bold hover:text-slate-200">&times;</button>
                </div>
                <div class="p-5 space-y-4">
                    <p class="text-sm text-slate-300">Añade puntos de desarrollo adicionales a tu plan mensual para incluir más servicios.</p>
                    <div>
                        <label for="extraPointsAmount" class="block text-sm font-medium text-slate-300 mb-1">Cantidad de Puntos a Comprar:</label>
                        <input type="number" id="extraPointsAmount" class="w-full styled-input" placeholder="0" min="1">
                    </div>
                    <p id="extraPointsCostFeedback" class="text-sm text-center font-bold text-yellow-300 h-5"></p>
                    <div class="text-right pt-2">
                        <button onclick="addExtraPoints()" class="bg-yellow-600 text-slate-900 font-bold py-2 px-4 rounded-lg hover:bg-yellow-500 transition">Añadir Puntos</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="pdfOptionsModal" class="hidden fixed inset-0 flex items-center justify-center modal-overlay transition-opacity duration-300">
            <div class="card-bg w-full max-w-lg rounded-xl shadow-2xl overflow-hidden transform transition-all" role="dialog" aria-modal="true">
                <div class="modal-header p-4 rounded-t-xl text-white font-bold bg-blue-600 flex justify-between items-center">
                    <h3 class="text-lg">Generar Documentos de Propuesta</h3>
                    <button onclick="closePdfOptionsModal()" class="text-2xl font-bold hover:text-slate-200">&times;</button>
                </div>
                <div class="p-5 space-y-4 max-h-[80vh] overflow-y-auto">
                    <div>
                        <label for="pdfLogoInput" class="block text-sm font-medium text-slate-300 mb-1">Tu Logo (Marca Blanca):</label>
                        <input type="file" id="pdfLogoInput" accept="image/*" class="w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-900 file:text-blue-300 hover:file:bg-blue-800">
                    </div>
                    <div>
                        <label for="pdfResellerInfo" class="block text-sm font-medium text-slate-300 mb-1">Tus Datos de Contacto:</label>
                        <textarea id="pdfResellerInfo" class="w-full styled-textarea" rows="3" placeholder="Tu Nombre / Nombre de tu Agencia&#10;tupaginaweb.com&#10;tu@email.com"></textarea>
                    </div>
                    <div>
                        <label for="pdfClientInfo" class="block text-sm font-medium text-slate-300 mb-1">Datos del Cliente Final:</label>
                        <textarea id="pdfClientInfo" class="w-full styled-textarea" rows="3" placeholder="Nombre del Contacto del Cliente&#10;Nombre de la Empresa Cliente&#10;email@cliente.com"></textarea>
                    </div>
                    <div>
                        <label for="pdfTerms" class="block text-sm font-medium text-slate-300 mb-1">Tus Términos y Condiciones:</label>
                        <textarea id="pdfTerms" class="w-full styled-textarea" rows="4" placeholder="Ej: Validez de la propuesta: 15 días. Condiciones de pago: 50% por adelantado para iniciar, 50% a la entrega final."></textarea>
                    </div>
                    <div class="pt-2 space-y-3">
                        <button onclick="generatePdf(true, this)" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition flex justify-center items-center gap-2" disabled>
                            <svg class="spinner h-5 w-5 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <span class="btn-text">Generar Propuesta para Cliente</span>
                        </button>
                        <button onclick="generatePdf(false, this)" class="w-full bg-slate-600 text-white font-bold py-2 rounded-lg hover:bg-slate-500 transition flex justify-center items-center gap-2" disabled>
                            <svg class="spinner h-5 w-5 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                 <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <span class="btn-text">Generar Reporte Interno</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="brandingModal" class="hidden fixed inset-0 flex items-center justify-center modal-overlay transition-opacity duration-300">
            <div class="card-bg w-full max-w-md rounded-xl shadow-2xl overflow-hidden transform transition-all" role="dialog" aria-modal="true">
                <div class="modal-header p-4 rounded-t-xl text-white font-bold bg-teal-600 flex justify-between items-center">
                    <h3 class="text-lg">Configuración de Marca</h3>
                    <button onclick="closeBrandingModal()" class="text-2xl font-bold hover:text-slate-200">&times;</button>
                </div>
                <div class="p-5 space-y-4">
                    <div>
                        <label for="brandLogoInput" class="block text-sm font-medium text-slate-300 mb-2">Tu Logo (para UI y PDFs):</label>
                        <input type="file" id="brandLogoInput" accept="image/*" class="w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-teal-900 file:text-teal-300 hover:file:bg-teal-800">
                        <button id="removeBrandLogo" class="text-xs text-red-400 hover:underline mt-1">Quitar logo</button>
                    </div>
                    <div>
                        <label for="brandColorInput" class="block text-sm font-medium text-slate-300 mb-2">Color de Acento:</label>
                        <input type="color" id="brandColorInput" class="w-full h-10 p-1 bg-slate-700 border border-slate-600 rounded-lg cursor-pointer">
                    </div>
                    <div class="text-right pt-2">
                        <button onclick="saveBranding()" class="bg-teal-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-teal-700 transition">Guardar Cambios</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="tieredBuilderModal" class="hidden fixed inset-0 flex items-center justify-center modal-overlay transition-opacity duration-300">
            <div class="card-bg w-full max-w-6xl rounded-xl shadow-2xl transform transition-all max-h-[90vh] flex flex-col" role="dialog" aria-modal="true">
                <div class="modal-header p-4 rounded-t-xl text-white font-bold bg-indigo-600 flex justify-between items-center flex-shrink-0">
                    <h3 class="text-lg">Constructor de Propuesta por Niveles</h3>
                    <button onclick="closeTieredBuilderModal()" class="text-2xl font-bold hover:text-slate-200">&times;</button>
                </div>
                <div class="p-5 flex-grow overflow-y-auto">
                    <p class="text-sm text-slate-400 mb-4 italic">Usa el nivel Básico para lo esencial, el Recomendado para la solución ideal, y el Completo para añadir todos los extras de alto valor.</p>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4" id="tiered-builder-columns">
                        <!-- Columnas se generarán aquí -->
                    </div>
                </div>
                <div class="p-4 bg-slate-900/50 rounded-b-xl flex-shrink-0 flex justify-end items-center gap-4">
                     <button onclick="closeTieredBuilderModal()" class="bg-slate-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-slate-500 transition">Cancelar</button>
                    <button onclick="addTieredProposal()" class="bg-indigo-600 text-white font-bold py-2 px-5 rounded-lg hover:bg-indigo-700 transition">Guardar Propuesta por Niveles</button>
                </div>
            </div>
        </div>
        
        <div id="tour-tooltip" class="hidden absolute bg-slate-800 border-2 border-cyan-400 p-4 rounded-lg shadow-2xl z-[10002] max-w-sm">
            <p id="tour-text" class="text-slate-200"></p>
            <div class="flex justify-between items-center mt-4">
                <span id="tour-step-counter" class="text-xs text-slate-400"></span>
                <div class="space-x-2">
                    <button id="tour-end" class="text-sm py-1 px-3 rounded bg-red-800 hover:bg-red-700 transition">Finalizar</button>
                    <button id="tour-prev" class="text-sm py-1 px-3 rounded bg-slate-600 hover:bg-slate-500 transition">Anterior</button>
                    <button id="tour-next" class="text-sm py-1 px-3 rounded accent-bg">Siguiente</button>
                </div>
            </div>
        </div>

        <!-- MODAL API KEY -->
        <div id="apiKeyModal" class="hidden fixed inset-0 flex items-center justify-center modal-overlay transition-opacity duration-300">
            <div class="card-bg w-full max-w-md rounded-xl shadow-2xl overflow-hidden transform transition-all" role="dialog" aria-modal="true" aria-labelledby="apiKeyModalTitle">
                <div class="modal-header p-4 rounded-t-xl text-white font-bold bg-red-600 flex justify-between items-center">
                    <h3 id="apiKeyModalTitle" class="text-lg">Configuración de Asistente IA</h3>
                </div>
                <div class="p-5 space-y-4">
                    <p class="text-sm text-slate-300">
                        Para activar el Asistente IA, por favor introduce tu propia API Key de Google AI. Tu clave se usará de forma segura solo durante esta sesión.
                    </p>
                    <div>
                        <label for="apiKeyInput" class="block text-sm font-medium text-slate-300 mb-1">Tu Google AI API Key:</label>
                        <input type="password" id="apiKeyInput" class="w-full styled-input" placeholder="Pega tu clave aquí">
                    </div>
                    <p class="text-xs text-slate-400">
                        ¿No tienes una clave? 
                        <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer" class="accent-color hover:underline font-semibold">
                            Obtén una API Key en Google AI Studio &rarr;
                        </a>
                    </p>
                    <div class="text-right pt-2">
                        <button onclick="handleSaveApiKey(this)" class="bg-red-600 text-white font-medium py-2 px-4 rounded-lg hover:bg-red-700 transition flex justify-center items-center gap-2">
                             <svg class="spinner h-5 w-5 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <span class="btn-text">Guardar y Activar</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- TÍTULO PRINCIPAL Y CONTROLES -->
        <div class="max-w-7xl mx-auto">
            <header class="text-center mb-8">
                <div class="flex justify-center items-center gap-4">
                    <img id="brand-logo-display" src="" alt="Logo" class="hidden h-12"/>
                    <h1 id="main-title" class="text-3xl sm:text-4xl font-extrabold accent-color tracking-wider">
                        Centro de Operaciones
                    </h1>
                </div>
                <p class="text-slate-400 mt-2">Crea, gestiona y exporta propuestas de alto impacto.</p>
                 <div class="mt-4 flex flex-wrap justify-center gap-3">
                    <button onclick="showBrandingModal()" class="text-sm bg-slate-700 hover:bg-slate-600 text-slate-200 font-semibold py-2 px-4 rounded-lg transition shadow-md">
                        ⚙️ Configuración de Marca
                    </button>
                    <button onclick="showApiKeyModal()" class="text-sm bg-slate-700 hover:bg-slate-600 text-slate-200 font-semibold py-2 px-4 rounded-lg transition shadow-md">
                        🔑 Cambiar API Key
                    </button>
                     <div class="flex items-center gap-1">
                        <button id="tieredBuilderBtn" onclick="showTieredBuilderModal()" class="text-sm bg-indigo-600 hover:bg-indigo-500 text-white font-semibold py-2 px-4 rounded-lg transition shadow-md">
                            📊 Propuesta por Niveles
                        </button>
                        <button onclick="showTieredBuilderHelp()" class="h-8 w-8 flex items-center justify-center rounded-full bg-slate-700 text-slate-300 hover:bg-slate-600 transition" aria-label="Ayuda sobre Propuesta por Niveles">
                            ?
                        </button>
                     </div>
                      <div class="flex items-center gap-2">
                        <button id="currency-toggle-btn" disabled class="text-sm bg-slate-700 hover:bg-slate-600 text-slate-200 font-semibold py-2 px-4 rounded-lg transition shadow-md disabled:opacity-50 disabled:cursor-not-allowed">
                            USD
                        </button>
                        <button id="refresh-rate-btn" disabled class="h-8 w-8 flex items-center justify-center rounded-full bg-slate-700 text-slate-300 hover:bg-slate-600 transition disabled:opacity-50 disabled:cursor-not-allowed" aria-label="Actualizar tipo de cambio">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                                <path fill-rule="evenodd" d="M15.312 11.424a5.5 5.5 0 01-9.201-4.42 5.5 5.5 0 011.66-1.991l2.543 2.544a.75.75 0 001.06-1.06L9.31 4.439a.75.75 0 00-1.06 0L5.698 7.03a.75.75 0 001.06 1.06l2.36-2.36a4 4 0 006.182 3.182.75.75 0 00.81-1.488zM4.688 8.576a5.5 5.5 0 019.201 4.42 5.5 5.5 0 01-1.66 1.991l-2.543-2.544a.75.75 0 00-1.06 1.06l2.558 2.559a.75.75 0 001.06 0l2.552-2.551a.75.75 0 00-1.06-1.06l-2.36 2.36a4 4 0 00-6.182-3.182.75.75 0 00-.81 1.488z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Contenedor Principal -->
            <div id="appContainer" class="flex flex-col lg:grid lg:grid-cols-3 xl:grid-cols-4 gap-8">
                <!-- COLUMNA 1 & 2: Formulario -->
                <div class="lg:col-span-2 xl:col-span-3 space-y-6">
                    <div id="proposal-details-container" class="card-bg p-5 rounded-xl shadow-lg border border-slate-700">
                        <h2 class="text-2xl font-semibold mb-4 accent-color">1. Iniciar Nueva Propuesta</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <input type="text" id="clientName" placeholder="Nombre del Cliente" class="styled-input">
                            <input type="text" id="webName" placeholder="Nombre del Proyecto" class="styled-input">
                            <select id="serviceType" class="styled-input styled-select accent-color">
                                <option value="puntual">Proyecto de Pago Único</option>
                                <option value="mensual">Servicio Mensual (Retainer)</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- CONTENEDOR DEL CHAT IA -->
                    <div id="ai-assistant-container" class="card-bg p-5 rounded-xl shadow-lg border border-slate-700 flex flex-col h-[500px]">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center">
                                <h2 class="text-2xl font-semibold text-purple-400">Asistente IA de Ventas</h2>
                                <span id="ai-status-indicator" class="ml-3 h-3 w-3 bg-red-500 rounded-full"></span>
                            </div>
                            <div class="theme-switch-wrapper">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="icon"><path d="M10 2a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0110 2zM10 15a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0110 15zM10 7a3 3 0 100 6 3 3 0 000-6zM15.657 5.404a.75.75 0 10-1.06-1.06l-1.061 1.06a.75.75 0 001.06 1.06l1.06-1.06zM6.464 14.596a.75.75 0 10-1.06-1.06l-1.06 1.06a.75.75 0 001.06 1.06l1.06-1.06zM18 10a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0118 10zM5 10a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 015 10zM14.596 15.657a.75.75 0 001.06-1.06l-1.06-1.061a.75.75 0 10-1.06 1.06l1.06 1.06zM5.404 6.464a.75.75 0 001.06-1.06l-1.06-1.06a.75.75 0 10-1.06 1.06l1.06 1.06z"/></svg>
                                <label class="theme-switch" for="chat-theme-toggle">
                                    <input type="checkbox" id="chat-theme-toggle">
                                    <span class="slider"></span>
                                </label>
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="icon"><path fill-rule="evenodd" d="M7.455 2.164A.75.75 0 018 2.5v1.25a.75.75 0 01-1.5 0V3.065a8.5 8.5 0 00-5.438 6.942 9.009 9.009 0 003.354 7.512.75.75 0 01-1.026 1.09 10.509 10.509 0 01-3.88-8.602A10.001 10.001 0 018.75 2.055a.75.75 0 01-.545-.644.75.75 0 01.25-.748zM12.23 18.63a.75.75 0 01.748-.25.75.75 0 01.644.545 10.001 10.001 0 01-10.748 3.55 1.5 1.5 0 01-.32-2.924 10.05 10.05 0 015.613-5.562.75.75 0 01.966 1.139 8.548 8.548 0 00-4.63 4.725 8.5 8.5 0 007.477-2.168z" clip-rule="evenodd"/></svg>
                            </div>
                        </div>

                        <div id="chat-mode-selector" class="flex justify-start mb-2 border-b border-slate-700 -mx-5 px-5">
                            <button data-mode="builder" class="chat-mode-btn active">Constructor</button>
                            <button data-mode="objection" class="chat-mode-btn">Objeciones</button>
                            <button data-mode="analyze" class="chat-mode-btn">Analizar Conversación</button>
                        </div>
                        
                        <div id="chat-messages" class="flex-grow space-y-4 overflow-y-auto p-2 bg-slate-900/50 rounded-lg border border-slate-700">
                            <!-- Los mensajes del chat aparecerán aquí dinámicamente -->
                        </div>

                        <div class="flex items-center gap-2 pt-4 border-t border-slate-700">
                            <input type="text" id="chat-input" class="w-full styled-input" placeholder="Ej: 'Necesito una web para un fotógrafo...' ">
                            <button id="chat-send-btn" class="accent-bg font-bold p-3 rounded-lg shadow-md transition duration-300">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                                    <path d="M3.105 2.289a.75.75 0 00-.826.95l1.414 4.949a.75.75 0 00.95.546l4.209-1.202a.75.75 0 01.531 1.343l-4.21 1.202a.75.75 0 00-.95.546l-1.414 4.95a.75.75 0 00.826.95L19 10.354a.75.75 0 000-1.418L3.105 2.289z" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div id="solution-config-container" class="card-bg p-5 rounded-xl shadow-lg border border-slate-700">
                        <h2 class="text-2xl font-semibold mb-4 accent-color">2. Configurar la Solución</h2>
                        <p class="text-sm text-slate-400 mb-4">Elige una solución integral (Paquete/Plan) o selecciona ítems específicos.</p>
                        
                        <div id="modeIndicator" class="mb-4 p-3 rounded-lg border border-yellow-500 bg-yellow-900/20 text-yellow-300 font-bold text-center">
                            Modo Activo: Selección Personalizada
                        </div>
                        
                        <div class="flex flex-col sm:flex-row gap-4 mb-4">
                            <button id="clearSelectionsBtn" class="hidden flex-grow bg-red-600 text-white font-bold py-2 rounded-lg hover:bg-red-700 transition shadow-lg">
                                Limpiar Selección y Activar Modo Personalizado
                            </button>
                            <button onclick="showCustomServiceModal()" class="flex-grow bg-purple-600 text-white font-bold py-2 rounded-lg hover:bg-purple-700 transition shadow-lg">
                                + Añadir Ítem Personalizado
                            </button>
                        </div>

                        <div id="monthlyPlansContainer" class="hidden space-y-6"></div>

                        <!-- ESTRUCTURA PARA SERVICIOS MENSUALES (SISTEMA DE PUNTOS) -->
                        <div id="monthlyServicesContainer" class="hidden space-y-6">
                            <div id="pointsDisplay" class="points-display flex justify-between items-center">
                                <div>Puntos de Desarrollo: <span id="planPointsCounter">0 / 0</span></div>
                                <button id="buyExtraPointsBtn" onclick="showExtraPointsModal()" class="hidden text-sm bg-yellow-600 text-slate-900 font-bold py-1 px-3 rounded-lg hover:bg-yellow-500 transition shadow-md">+ Comprar Puntos</button>
                            </div>
                            <div id="servicesTabs" class="space-y-4">
                                <!-- Categorías se insertarán dinámicamente aquí -->
                            </div>
                        </div>

                        <div id="servicesSelection" class="space-y-6"></div>
                    </div>
                </div>

                <!-- COLUMNA 3 & 4: Resumen y Dashboard -->
                <div class="lg:col-span-1 xl:col-span-1 space-y-6">
                    
                    <div id="summaryCard" class="card-bg p-5 rounded-xl shadow-lg border border-slate-700 top-4">
                        <h2 class="text-2xl font-semibold mb-4 accent-color">3. Calcular Rentabilidad</h2>
                        <div class="mb-4">
                            <label for="marginPercentage" class="block text-sm font-medium text-slate-300 mb-2">Tu Margen de Ganancia (%)</label>
                            <input type="number" id="marginPercentage" value="60" min="0" class="w-full styled-input accent-color">
                            <p id="marginFeedback" class="text-xs mt-1 text-slate-400"></p>
                        </div>
                        <div class="text-lg font-bold space-y-2 pt-4 border-t border-slate-700">
                            <p>Costo Producción: <span id="totalDeveloperPrice">$0.00 USD</span></p>
                            <p class="accent-color">Precio a Cliente: <span id="totalClientPrice">$0.00 USD</span></p>
                        </div>
                        <button id="addTask" class="w-full accent-bg font-bold py-3 mt-4 rounded-lg transition shadow-xl">Guardar Propuesta</button>
                        <h3 class="text-md font-semibold mt-6 mb-2 text-slate-300 border-t border-slate-700 pt-4">Resumen de la Solución:</h3>
                        <div id="selectedItems" class="text-sm space-y-2 p-3 bg-slate-900 rounded-lg h-40 overflow-y-auto border border-slate-700">
                            <p class="text-slate-400">Los servicios seleccionados aparecerán aquí.</p>
                        </div>
                    </div>

                    <div id="saved-proposals-container" class="card-bg p-5 rounded-xl shadow-lg border border-slate-700">
                        <h2 class="text-2xl font-semibold mb-4 text-pink-400">4. Propuestas Guardadas</h2>
                        <div id="tasksDashboard" class="space-y-4"><p class="text-slate-400">Aún no hay propuestas guardadas.</p></div>
                        <div class="text-lg font-bold space-y-2 pt-4 mt-4 border-t border-slate-700">
                            <p>COSTO TOTAL (Prod): <span id="grandTotalDeveloperPrice">$0.00 USD</span></p>
                            <p class="text-green-400">VENTA TOTAL: <span id="grandTotalClientPrice">$0.00 USD</span></p>
                            <p class="text-yellow-400">GANANCIA TOTAL: <span id="totalProfit">$0.00 USD</span></p>
                        </div>
                        <div class="mt-4 flex gap-2">
                            <button id="exportPdfBtn" onclick="showPdfOptionsModal()" class="flex-grow bg-slate-600 text-white font-bold py-2 rounded-lg hover:bg-slate-500 transition shadow-lg action-button">Generar Documentos</button>
                            <button id="clearAllTasksBtn" class="flex-grow bg-red-800 text-white font-bold py-2 rounded-lg hover:bg-red-700 transition shadow-lg action-button">Limpiar Todo</button>
                        </div>
                        <div class="mt-4 text-sm text-slate-500 text-center border-t border-slate-700 pt-4">
                            <a href="pricing.html" class="accent-color hover:underline">Gestionar Catálogo de Servicios</a>
                        </div>
                    </div>
                    <div id="messageContainer" class="mt-4"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
    <script type="module" src="js/modals.js"></script>
    <script type="module" src="js/pdf.js"></script>
    <script type="module" src="js/chat-frontend.js"></script>

</body>
</html>